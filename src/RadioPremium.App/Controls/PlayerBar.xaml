<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="RadioPremium.App.Controls.PlayerBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:RadioPremium.App.Converters">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
        <converters:PlaybackStateToIconConverter x:Key="PlaybackStateToIconConverter" />
        <converters:FavoriteToIconConverter x:Key="FavoriteToIconConverter" />
        <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
        <converters:BoolToOpacityConverter x:Key="BoolToOpacityConverter" />
    </UserControl.Resources>
    <!-- Spotify Player Bar with Dark Background -->
    <Border 
        Height="90"
        BorderBrush="#282828"
        BorderThickness="0,1,0,0"
        Background="{StaticResource BackgroundPrimaryBrush}">
        
        <Grid Padding="16,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" MinWidth="200" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" MinWidth="250" />
            </Grid.ColumnDefinitions>

            <!-- ============================================ -->
            <!-- LEFT: Now Playing Info -->
            <!-- ============================================ -->
            <StackPanel 
                Grid.Column="0"
                Orientation="Horizontal"
                Spacing="12"
                VerticalAlignment="Center"
                HorizontalAlignment="Left">
                
                <!-- Station Artwork -->
                <Grid
                    Visibility="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    
                    <!-- Glow effect (visible when playing) -->
                    <Border 
                        x:Name="ArtworkGlow"
                        Width="56"
                        Height="56"
                        CornerRadius="4"
                        Opacity="0">
                        <Border.Background>
                            <SolidColorBrush Color="{StaticResource SpotifyGreen}" />
                        </Border.Background>
                        <Border.Shadow>
                            <ThemeShadow />
                        </Border.Shadow>
                    </Border>
                    
                    <!-- Artwork -->
                    <Border 
                        Width="56"
                        Height="56"
                        CornerRadius="4"
                        Background="{StaticResource BackgroundTertiaryBrush}">
                        <Grid>
                            <Border CornerRadius="4">
                                <Image 
                                    x:Name="StationLogo"
                                    Stretch="UniformToFill" />
                            </Border>
                            <FontIcon 
                                Glyph="&#xE95A;"
                                FontSize="20"
                                Foreground="{StaticResource TextTertiaryBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Grid>
                    </Border>
                </Grid>

                <!-- Station Info -->
                <StackPanel 
                    VerticalAlignment="Center"
                    Spacing="4"
                    Visibility="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    
                    <TextBlock 
                        x:Name="StationName"
                        Text="{x:Bind ViewModel.CurrentStation.Name, Mode=OneWay}"
                        FontSize="14"
                        FontWeight="Normal"
                        Foreground="{StaticResource TextPrimaryBrush}"
                        TextTrimming="CharacterEllipsis"
                        MaxWidth="180" />
                    
                    <TextBlock 
                        x:Name="StationCountry"
                        Text="{x:Bind ViewModel.CurrentStation.FormattedMetadata, Mode=OneWay}"
                        FontSize="11"
                        Foreground="{StaticResource TextSecondaryBrush}" />
                </StackPanel>

                <!-- Favorite Button (next to station info, like Spotify) -->
                <Button 
                    x:Name="FavoriteButton"
                    Click="Favorite_Click"
                    Background="Transparent"
                    BorderThickness="0"
                    Width="32"
                    Height="32"
                    Padding="0"
                    ToolTipService.ToolTip="Añadir a favoritos"
                    IsEnabled="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToBoolConverter}}"
                    Visibility="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}"
                    PointerEntered="ActionButton_PointerEntered"
                    PointerExited="ActionButton_PointerExited">
                    <FontIcon 
                        x:Name="FavoriteIcon"
                        Glyph="{x:Bind ViewModel.IsCurrentStationFavorite, Mode=OneWay, Converter={StaticResource FavoriteToIconConverter}}"
                        FontSize="16"
                        Foreground="{StaticResource SpotifyGreenBrush}" />
                </Button>

                <!-- No Station Placeholder -->
                <TextBlock 
                    Text="Selecciona una emisora"
                    FontSize="14"
                    Foreground="{StaticResource TextTertiaryBrush}"
                    VerticalAlignment="Center"
                    Visibility="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}" />
            </StackPanel>

            <!-- ============================================ -->
            <!-- CENTER: Playback Controls -->
            <!-- ============================================ -->
            <StackPanel 
                Grid.Column="1"
                VerticalAlignment="Center"
                HorizontalAlignment="Center"
                Spacing="8">
                
                <!-- Control Buttons Row -->
                <StackPanel 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Center"
                    Spacing="16">
                    
                    <!-- Shuffle Button -->
                    <Button
                        Click="Shuffle_Click"
                        Background="Transparent"
                        BorderThickness="0"
                        Width="32"
                        Height="32"
                        Padding="0"
                        ToolTipService.ToolTip="Aleatorio">
                        <FontIcon
                            Glyph="&#xE8B1;"
                            FontSize="16"
                            Foreground="{x:Bind ViewModel.IsShuffleEnabled, Mode=OneWay, Converter={StaticResource BoolToColorConverter}, ConverterParameter='SpotifyGreen'}" />
                    </Button>

                    <!-- Previous Button -->
                    <Button
                        Click="Previous_Click"
                        Background="Transparent"
                        BorderThickness="0"
                        Width="32"
                        Height="32"
                        Padding="0"
                        IsEnabled="{x:Bind ViewModel.CanPlayPrevious, Mode=OneWay}"
                        Opacity="{x:Bind ViewModel.CanPlayPrevious, Mode=OneWay, Converter={StaticResource BoolToOpacityConverter}}"
                        ToolTipService.ToolTip="Anterior">
                        <FontIcon
                            Glyph="&#xE892;"
                            FontSize="22"
                            Foreground="{StaticResource TextSecondaryBrush}" />
                    </Button>
                    
                    <!-- Play/Pause Button - Central and prominent -->
                    <Button 
                        x:Name="PlayPauseButton"
                        Click="PlayPause_Click"
                        Width="36"
                        Height="36"
                        CornerRadius="18"
                        Background="{StaticResource TextPrimaryBrush}"
                        BorderThickness="0"
                        Padding="0"
                        ToolTipService.ToolTip="Reproducir/Pausar"
                        PointerEntered="PlayButton_PointerEntered"
                        PointerExited="PlayButton_PointerExited">
                        <FontIcon 
                            Glyph="{x:Bind ViewModel.PlaybackState, Mode=OneWay, Converter={StaticResource PlaybackStateToIconConverter}}"
                            FontSize="16"
                            Foreground="Black" />
                    </Button>
                    
                    <!-- Next Button -->
                    <Button
                        Click="Next_Click"
                        Background="Transparent"
                        BorderThickness="0"
                        Width="32"
                        Height="32"
                        Padding="0"
                        IsEnabled="{x:Bind ViewModel.CanPlayNext, Mode=OneWay}"
                        Opacity="{x:Bind ViewModel.CanPlayNext, Mode=OneWay, Converter={StaticResource BoolToOpacityConverter}}"
                        ToolTipService.ToolTip="Siguiente">
                        <FontIcon
                            Glyph="&#xE893;"
                            FontSize="22"
                            Foreground="{StaticResource TextSecondaryBrush}" />
                    </Button>

                    <!-- Repeat Button -->
                    <Button
                        Click="Repeat_Click"
                        Background="Transparent"
                        BorderThickness="0"
                        Width="32"
                        Height="32"
                        Padding="0"
                        ToolTipService.ToolTip="Repetir">
                        <FontIcon
                            Glyph="&#xE8EE;"
                            FontSize="16"
                            Foreground="{x:Bind ViewModel.IsRepeatEnabled, Mode=OneWay, Converter={StaticResource BoolToColorConverter}, ConverterParameter='SpotifyGreen'}" />
                    </Button>
                </StackPanel>
                
                <!-- Progress/Live Indicator Bar -->
                <Grid MaxWidth="400" HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- Live Indicator or Time -->
                    <StackPanel 
                        Grid.Column="0" 
                        Orientation="Horizontal" 
                        Spacing="4"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0">
                        <Ellipse 
                            x:Name="LiveDot"
                            Width="8" 
                            Height="8" 
                            Fill="{StaticResource SpotifyGreenBrush}"
                            Visibility="{x:Bind ViewModel.IsPlaying, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                        <TextBlock 
                            Text="EN VIVO"
                            FontSize="10"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextSecondaryBrush}"
                            Visibility="{x:Bind ViewModel.IsPlaying, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>
                    
                    <!-- Progress Bar (decorative for live radio) -->
                    <Grid Grid.Column="1" Height="4" VerticalAlignment="Center">
                        <Border 
                            Background="{StaticResource BackgroundHighlightBrush}"
                            CornerRadius="2" />
                        <Border 
                            x:Name="ProgressFill"
                            Background="{StaticResource SpotifyGreenBrush}"
                            CornerRadius="2"
                            HorizontalAlignment="Left"
                            Width="0" />
                    </Grid>
                    
                    <!-- Stream Quality -->
                    <TextBlock 
                        Grid.Column="2"
                        Text="RADIO"
                        FontSize="10"
                        FontWeight="SemiBold"
                        Foreground="{StaticResource TextSecondaryBrush}"
                        VerticalAlignment="Center"
                        Margin="8,0,0,0" />
                </Grid>
            </StackPanel>

            <!-- ============================================ -->
            <!-- RIGHT: Volume & Extra Controls -->
            <!-- ============================================ -->
            <StackPanel 
                Grid.Column="2"
                Orientation="Horizontal"
                Spacing="12"
                HorizontalAlignment="Right"
                VerticalAlignment="Center">

                <!-- Identify Button (Shazam-style) - PROMINENT -->
                <Button 
                    x:Name="IdentifyButton"
                    Click="Identify_Click"
                    Background="{StaticResource SpotifyGreenBrush}"
                    Foreground="Black"
                    CornerRadius="18"
                    Height="36"
                    Padding="16,0"
                    BorderThickness="0"
                    ToolTipService.ToolTip="Identificar canción (Ctrl+I)"
                    PointerEntered="ActionButton_PointerEntered"
                    PointerExited="ActionButton_PointerExited">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8D6;" FontSize="16" />
                        <TextBlock Text="Identificar" FontSize="13" FontWeight="Bold" />
                    </StackPanel>
                </Button>

                <!-- Mini Player Toggle -->
                <Button
                    Click="MiniPlayer_Click"
                    Background="Transparent"
                    BorderThickness="0"
                    Width="32"
                    Height="32"
                    Padding="0"
                    ToolTipService.ToolTip="Modo mini-player"
                    PointerEntered="ActionButton_PointerEntered"
                    PointerExited="ActionButton_PointerExited">
                    <FontIcon
                        Glyph="&#xE73F;"
                        FontSize="16"
                        Foreground="{StaticResource TextSecondaryBrush}" />
                </Button>

                <!-- Volume Control Group -->
                <StackPanel Orientation="Horizontal" Spacing="0">
                    <!-- Volume Icon (clickable to mute) -->
                    <Button
                        x:Name="VolumeButton"
                        Click="Mute_Click"
                        Background="Transparent"
                        BorderThickness="0"
                        Width="32"
                        Height="32"
                        Padding="0"
                        ToolTipService.ToolTip="Silenciar"
                        PointerEntered="ActionButton_PointerEntered"
                        PointerExited="ActionButton_PointerExited">
                        <FontIcon
                            x:Name="VolumeIcon"
                            Glyph="&#xE767;"
                            FontSize="16"
                            Foreground="{StaticResource TextSecondaryBrush}" />
                    </Button>

                    <!-- Volume Slider -->
                    <Slider
                        x:Name="VolumeSlider"
                        Width="100"
                        Minimum="0"
                        Maximum="1"
                        StepFrequency="0.01"
                        Value="{x:Bind ViewModel.Volume, Mode=TwoWay}"
                        ValueChanged="VolumeSlider_ValueChanged"
                        VerticalAlignment="Center" />
                </StackPanel>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>

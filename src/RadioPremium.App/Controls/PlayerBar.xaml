<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="RadioPremium.App.Controls.PlayerBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:RadioPremium.App.Converters">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
        <converters:PlaybackStateToIconConverter x:Key="PlaybackStateToIconConverter" />
        <converters:FavoriteToIconConverter x:Key="FavoriteToIconConverter" />
    </UserControl.Resources>

    <!-- Premium Player Bar with Acrylic Background -->
    <Border 
        Height="76"
        BorderBrush="#0A000000"
        BorderThickness="0,0.5,0,0">
        
        <Border.Background>
            <AcrylicBrush 
                TintColor="#FFFFFF"
                TintOpacity="0.72"
                TintLuminosityOpacity="0.92"
                FallbackColor="#F8F8F8" />
        </Border.Background>
        
        <Grid Padding="20,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Now Playing Info (Left) -->
            <StackPanel 
                Grid.Column="0"
                Orientation="Horizontal"
                Spacing="14"
                VerticalAlignment="Center">
                
                <!-- Station Artwork with Glow when playing -->
                <Grid
                    Visibility="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    
                    <!-- Glow effect (visible when playing) -->
                    <Border 
                        x:Name="ArtworkGlow"
                        Width="52"
                        Height="52"
                        CornerRadius="10"
                        Opacity="0">
                        <Border.Background>
                            <SolidColorBrush Color="{StaticResource AppleRed}" />
                        </Border.Background>
                        <Border.Shadow>
                            <ThemeShadow />
                        </Border.Shadow>
                    </Border>
                    
                    <!-- Artwork -->
                    <Border 
                        Width="52"
                        Height="52"
                        CornerRadius="10"
                        Background="{StaticResource BackgroundTertiaryBrush}">
                        <Grid>
                            <Border CornerRadius="10">
                                <Image 
                                    x:Name="StationLogo"
                                    Stretch="UniformToFill" />
                            </Border>
                            <FontIcon 
                                Glyph="&#xE95A;"
                                FontSize="20"
                                Foreground="{StaticResource TextTertiaryBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Grid>
                    </Border>
                </Grid>

                <!-- Station Info with Equalizer -->
                <StackPanel 
                    VerticalAlignment="Center"
                    Spacing="2"
                    Visibility="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    
                    <!-- Name row with equalizer -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <!-- Equalizer bars (visible when playing) -->
                        <Grid 
                            x:Name="EqualizerBars"
                            Width="14"
                            Height="14"
                            VerticalAlignment="Center"
                            Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="4" />
                                <ColumnDefinition Width="1" />
                                <ColumnDefinition Width="4" />
                                <ColumnDefinition Width="1" />
                                <ColumnDefinition Width="4" />
                            </Grid.ColumnDefinitions>
                            
                            <!-- Bar 1 -->
                            <Border 
                                x:Name="EqBar1"
                                Grid.Column="0"
                                Background="{StaticResource AppleRedBrush}"
                                CornerRadius="1"
                                Height="6"
                                VerticalAlignment="Bottom" />
                            <!-- Bar 2 -->
                            <Border 
                                x:Name="EqBar2"
                                Grid.Column="2"
                                Background="{StaticResource AppleRedBrush}"
                                CornerRadius="1"
                                Height="10"
                                VerticalAlignment="Bottom" />
                            <!-- Bar 3 -->
                            <Border 
                                x:Name="EqBar3"
                                Grid.Column="4"
                                Background="{StaticResource AppleRedBrush}"
                                CornerRadius="1"
                                Height="4"
                                VerticalAlignment="Bottom" />
                        </Grid>
                        
                        <TextBlock 
                            x:Name="StationName"
                            Text="{x:Bind ViewModel.CurrentStation.Name, Mode=OneWay}"
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextPrimaryBrush}"
                            TextTrimming="CharacterEllipsis"
                            MaxWidth="220" />
                    </StackPanel>
                    
                    <TextBlock 
                        x:Name="StationCountry"
                        Text="{x:Bind ViewModel.CurrentStation.FormattedMetadata, Mode=OneWay}"
                        FontSize="12"
                        Foreground="{StaticResource TextSecondaryBrush}" />
                </StackPanel>

                <!-- No Station Placeholder -->
                <TextBlock 
                    Text="Selecciona una emisora"
                    FontSize="14"
                    Foreground="{StaticResource TextTertiaryBrush}"
                    VerticalAlignment="Center"
                    Visibility="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}" />
            </StackPanel>

            <!-- Playback Controls (Center) - Only Play/Pause -->
            <Grid 
                Grid.Column="1"
                VerticalAlignment="Center">
                
                <!-- Play/Pause Button - Larger and centered -->
                <Button 
                    x:Name="PlayPauseButton"
                    Click="PlayPause_Click"
                    Width="48"
                    Height="48"
                    CornerRadius="24"
                    Background="{StaticResource TextPrimaryBrush}"
                    BorderThickness="0"
                    ToolTipService.ToolTip="Reproducir/Pausar"
                    PointerEntered="PlayButton_PointerEntered"
                    PointerExited="PlayButton_PointerExited">
                    <FontIcon 
                        Glyph="{x:Bind ViewModel.PlaybackState, Mode=OneWay, Converter={StaticResource PlaybackStateToIconConverter}}"
                        FontSize="18"
                        Foreground="White" />
                </Button>
            </Grid>

            <!-- Right Controls -->
            <StackPanel 
                Grid.Column="2"
                Orientation="Horizontal"
                Spacing="12"
                HorizontalAlignment="Right"
                VerticalAlignment="Center">

                <!-- Identify Button (Shazam-style) with hover animation -->
                <Button 
                    x:Name="IdentifyButton"
                    Click="Identify_Click"
                    Background="{StaticResource AppleRedBrush}"
                    Foreground="White"
                    CornerRadius="18"
                    Padding="14,8"
                    BorderThickness="0"
                    ToolTipService.ToolTip="Identificar canciÃ³n"
                    PointerEntered="ActionButton_PointerEntered"
                    PointerExited="ActionButton_PointerExited">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon Glyph="&#xE8D6;" FontSize="14" />
                        <TextBlock Text="Identificar" FontSize="12" FontWeight="SemiBold" />
                    </StackPanel>
                </Button>

                <!-- Favorite Button with animation -->
                <Button 
                    x:Name="FavoriteButton"
                    Click="Favorite_Click"
                    Style="{StaticResource AppleIconButtonStyle}"
                    ToolTipService.ToolTip="Favorito"
                    IsEnabled="{x:Bind ViewModel.CurrentStation, Mode=OneWay, Converter={StaticResource NullToBoolConverter}}"
                    PointerEntered="ActionButton_PointerEntered"
                    PointerExited="ActionButton_PointerExited">
                    <FontIcon 
                        x:Name="FavoriteIcon"
                        Glyph="{x:Bind ViewModel.IsCurrentStationFavorite, Mode=OneWay, Converter={StaticResource FavoriteToIconConverter}}"
                        FontSize="16"
                        Foreground="{StaticResource AppleRedBrush}" />
                </Button>

                <!-- Volume Control Group -->
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <!-- Volume Icon (clickable to mute) -->
                    <Button 
                        x:Name="VolumeButton"
                        Click="Mute_Click"
                        Style="{StaticResource AppleIconButtonStyle}"
                        ToolTipService.ToolTip="Silenciar"
                        PointerEntered="ActionButton_PointerEntered"
                        PointerExited="ActionButton_PointerExited">
                        <FontIcon 
                            x:Name="VolumeIcon"
                            Glyph="&#xE767;"
                            FontSize="16"
                            Foreground="{StaticResource TextSecondaryBrush}" />
                    </Button>

                    <!-- Volume Slider with custom styling -->
                    <Slider 
                        x:Name="VolumeSlider"
                        Width="100"
                        Minimum="0"
                        Maximum="1"
                        StepFrequency="0.01"
                        Value="{x:Bind ViewModel.Volume, Mode=TwoWay}"
                        ValueChanged="VolumeSlider_ValueChanged"
                        VerticalAlignment="Center" />
                </StackPanel>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>

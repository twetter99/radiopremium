<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="RadioPremium.App.Views.RadioPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:RadioPremium.App.Converters"
    Background="{StaticResource BackgroundSecondaryBrush}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:FavoriteToIconConverter x:Key="FavoriteToIconConverter" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Padding="40,32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,32">
                <TextBlock 
                    Text="Descubre"
                    Style="{StaticResource AppleLargeTitleStyle}" />
                <TextBlock 
                    Text="Encuentra emisoras de radio de todo el mundo"
                    Style="{StaticResource AppleCaptionStyle}"
                    Margin="0,4,0,0" />
            </StackPanel>

            <!-- Search Bar - Apple Style -->
            <Border 
                Grid.Row="1" 
                Background="White"
                CornerRadius="16"
                Padding="8"
                Margin="0,0,0,24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <FontIcon 
                        Grid.Column="0"
                        Glyph="&#xE721;"
                        FontSize="18"
                        Foreground="{StaticResource TextTertiaryBrush}"
                        Margin="12,0,8,0"
                        VerticalAlignment="Center" />

                    <TextBox 
                        x:Name="SearchBox"
                        Grid.Column="1"
                        PlaceholderText="Buscar emisoras, paÃ­ses o gÃ©neros..."
                        Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        KeyDown="SearchBox_KeyDown"
                        Background="Transparent"
                        BorderThickness="0"
                        FontSize="17"
                        VerticalAlignment="Center"
                        Padding="8,12" />

                    <Button 
                        Grid.Column="2"
                        Click="SearchButton_Click"
                        Style="{StaticResource ApplePrimaryButtonStyle}"
                        Margin="8,0,4,0">
                        <TextBlock Text="Buscar" FontWeight="SemiBold" />
                    </Button>
                </Grid>
            </Border>

            <!-- Filter Pills -->
            <ScrollViewer 
                Grid.Row="2" 
                HorizontalScrollBarVisibility="Auto"
                VerticalScrollBarVisibility="Disabled"
                Margin="0,0,0,24">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <ComboBox 
                        x:Name="CountryComboBox"
                        PlaceholderText="ðŸŒ PaÃ­s"
                        Width="160"
                        CornerRadius="20"
                        ItemsSource="{x:Bind ViewModel.Countries}"
                        DisplayMemberPath="Name"
                        SelectionChanged="CountryComboBox_SelectionChanged" />

                    <ComboBox 
                        x:Name="TagComboBox"
                        PlaceholderText="ðŸŽµ GÃ©nero"
                        Width="160"
                        CornerRadius="20"
                        ItemsSource="{x:Bind ViewModel.Tags}"
                        DisplayMemberPath="Name"
                        SelectionChanged="TagComboBox_SelectionChanged" />

                    <Button 
                        Content="ðŸ”¥ Populares"
                        Style="{StaticResource ApplePillButtonStyle}"
                        Click="PopularButton_Click" />

                    <Button 
                        Content="ðŸ†• Nuevas"
                        Style="{StaticResource ApplePillButtonStyle}"
                        Click="NewButton_Click" />
                </StackPanel>
            </ScrollViewer>

            <!-- Loading -->
            <ProgressRing 
                Grid.Row="3"
                IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                Width="48"
                Height="48"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,48,0,0" />

            <!-- Stations Grid -->
            <ItemsRepeater 
                x:Name="StationsRepeater"
                Grid.Row="3"
                ItemsSource="{x:Bind ViewModel.Stations}"
                Margin="0,8,0,0">
                
                <ItemsRepeater.Layout>
                    <UniformGridLayout 
                        MinItemWidth="340"
                        MinItemHeight="100"
                        MinRowSpacing="16"
                        MinColumnSpacing="16"
                        ItemsStretch="Fill" />
                </ItemsRepeater.Layout>

                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <Border 
                            Background="White"
                            CornerRadius="16"
                            Padding="16"
                            PointerEntered="StationCard_PointerEntered"
                            PointerExited="StationCard_PointerExited"
                            PointerPressed="StationCard_PointerPressed">
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Station Logo -->
                                <Border 
                                    Grid.Column="0"
                                    Width="64"
                                    Height="64"
                                    CornerRadius="14"
                                    Background="{StaticResource BackgroundSecondaryBrush}"
                                    Margin="0,0,16,0">
                                    <Grid>
                                        <Image 
                                            Source="{Binding Favicon}"
                                            Stretch="UniformToFill" />
                                        <FontIcon 
                                            Glyph="&#xE95A;"
                                            FontSize="24"
                                            Foreground="{StaticResource TextTertiaryBrush}"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                                    </Grid>
                                </Border>

                                <!-- Station Info -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="4">
                                    <TextBlock 
                                        Text="{Binding Name}"
                                        FontSize="17"
                                        FontWeight="SemiBold"
                                        Foreground="{StaticResource TextPrimaryBrush}"
                                        TextTrimming="CharacterEllipsis"
                                        MaxLines="1" />
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock 
                                            Text="{Binding Country}"
                                            FontSize="14"
                                            Foreground="{StaticResource TextSecondaryBrush}" />
                                        <TextBlock 
                                            Text="â€¢"
                                            FontSize="14"
                                            Foreground="{StaticResource TextTertiaryBrush}" />
                                        <TextBlock 
                                            Text="{Binding Tags}"
                                            FontSize="14"
                                            Foreground="{StaticResource TextSecondaryBrush}"
                                            TextTrimming="CharacterEllipsis"
                                            MaxLines="1" />
                                    </StackPanel>
                                    <TextBlock 
                                        FontSize="12"
                                        Foreground="{StaticResource TextTertiaryBrush}">
                                        <Run Text="{Binding Bitrate}" />
                                        <Run Text="kbps" />
                                    </TextBlock>
                                </StackPanel>

                                <!-- Play Button -->
                                <Button 
                                    Grid.Column="2"
                                    Tag="{Binding}"
                                    Click="PlayButton_Click"
                                    Style="{StaticResource PlayButtonStyle}"
                                    VerticalAlignment="Center">
                                    <FontIcon 
                                        Glyph="&#xE768;" 
                                        FontSize="18"
                                        Margin="2,0,0,0" />
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>

            <!-- Empty State -->
            <StackPanel 
                Grid.Row="3"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Visibility="{x:Bind ViewModel.Stations.Count, Mode=OneWay, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Invert}">
                <Border
                    Width="120"
                    Height="120"
                    CornerRadius="60"
                    Background="{StaticResource BackgroundTertiaryBrush}"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,24">
                    <FontIcon 
                        Glyph="&#xE95A;"
                        FontSize="48"
                        Foreground="{StaticResource TextTertiaryBrush}" />
                </Border>
                <TextBlock 
                    Text="No hay emisoras"
                    Style="{StaticResource AppleTitleStyle}"
                    HorizontalAlignment="Center" />
                <TextBlock 
                    Text="Busca o selecciona un filtro para comenzar"
                    Style="{StaticResource AppleCaptionStyle}"
                    HorizontalAlignment="Center"
                    Margin="0,8,0,0" />
            </StackPanel>
        </Grid>
    </ScrollViewer>
</Page>

<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="RadioPremium.App.Views.ShellPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:RadioPremium.App.Controls"
    xmlns:converters="using:RadioPremium.App.Converters"
    Background="{StaticResource BackgroundSecondaryBrush}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Main Content Area (Sidebar + Content) -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="240" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Radio Premium Sidebar - Spotify Dark -->
            <Border 
                Grid.Column="0"
                Background="{StaticResource SidebarBackgroundBrush}"
                BorderBrush="#282828"
                BorderThickness="0,0,1,0">
                
                <ScrollViewer 
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- App Logo/Brand - with top padding for title bar -->
                    <StackPanel Grid.Row="0" Margin="16,48,16,16">
                        <TextBlock 
                            Text="Radio Premium"
                            FontSize="18"
                            FontWeight="Bold"
                            Foreground="{StaticResource TextPrimaryBrush}" />
                    </StackPanel>

                    <!-- PRIMARY: Now Playing (Destacado) -->
                    <StackPanel Grid.Row="1" Margin="12,0,12,0">
                        <Button 
                            x:Name="RadioNavButton"
                            Click="RadioNav_Click"
                            Height="44"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Left"
                            Background="{StaticResource AppleRedBrush}"
                            CornerRadius="10"
                            Padding="14,0"
                            BorderThickness="0">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Grid>
                                    <FontIcon 
                                        Glyph="&#xE95A;" 
                                        FontSize="18"
                                        Foreground="White" />
                                    <!-- Live indicator dot -->
                                    <Ellipse 
                                        Width="6" 
                                        Height="6" 
                                        Fill="White"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Margin="0,-2,-2,0" />
                                </Grid>
                                <TextBlock 
                                    Text="Escuchar ahora" 
                                    FontSize="14" 
                                    FontWeight="SemiBold"
                                    Foreground="White" />
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- EXPLORAR Section -->
                    <StackPanel Grid.Row="2" Margin="12,24,12,0">
                        <TextBlock 
                            Text="EXPLORAR"
                            FontSize="11"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextTertiaryBrush}"
                            Margin="14,0,0,8"
                            CharacterSpacing="50" />
                        
                        <StackPanel Spacing="2">
                            <Button 
                                x:Name="GenresNavButton"
                                Click="GenresNav_Click"
                                Style="{StaticResource NavButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <FontIcon 
                                        Glyph="&#xE8D6;" 
                                        FontSize="16"
                                        Foreground="{StaticResource AppleOrangeBrush}" />
                                    <TextBlock Text="Por género" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                                </StackPanel>
                            </Button>

                            <Button 
                                x:Name="CountriesNavButton"
                                Click="CountriesNav_Click"
                                Style="{StaticResource NavButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <FontIcon 
                                        Glyph="&#xE909;" 
                                        FontSize="16"
                                        Foreground="{StaticResource AppleBlueBrush}" />
                                    <TextBlock Text="Por país" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                                </StackPanel>
                            </Button>

                            <Button 
                                x:Name="TrendingNavButton"
                                Click="TrendingNav_Click"
                                Style="{StaticResource NavButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <FontIcon 
                                        Glyph="&#xE8B1;" 
                                        FontSize="16"
                                        Foreground="{StaticResource ApplePinkBrush}" />
                                    <TextBlock Text="Tendencias" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <!-- TU BIBLIOTECA Section -->
                    <StackPanel Grid.Row="3" Margin="12,24,12,0">
                        <TextBlock 
                            Text="TU BIBLIOTECA"
                            FontSize="11"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextTertiaryBrush}"
                            Margin="14,0,0,8"
                            CharacterSpacing="50" />
                        
                        <StackPanel Spacing="2">
                            <Button 
                                x:Name="FavoritesNavButton"
                                Click="FavoritesNav_Click"
                                Style="{StaticResource NavButtonStyle}">
                                <Grid HorizontalAlignment="Stretch">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <FontIcon 
                                            Glyph="&#xEB52;" 
                                            FontSize="16"
                                            Foreground="{StaticResource SpotifyGreenBrush}" />
                                        <TextBlock Text="Favoritas" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                                    </StackPanel>
                                    <!-- Badge de conteo -->
                                    <Border 
                                        HorizontalAlignment="Right"
                                        Background="{StaticResource BackgroundTertiaryBrush}"
                                        CornerRadius="10"
                                        Padding="8,2"
                                        Visibility="Collapsed">
                                        <TextBlock 
                                            x:Name="FavoritesCount"
                                            Text="0"
                                            FontSize="11"
                                            Foreground="{StaticResource TextSecondaryBrush}" />
                                    </Border>
                                </Grid>
                            </Button>

                            <Button 
                                x:Name="RecentsNavButton"
                                Style="{StaticResource NavButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <FontIcon 
                                        Glyph="&#xE81C;" 
                                        FontSize="16"
                                        Foreground="{StaticResource ApplePurpleBrush}" />
                                    <TextBlock Text="Recientes" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                                </StackPanel>
                            </Button>

                            <Button
                                x:Name="IdentifiedNavButton"
                                Click="IdentifiedNav_Click"
                                Style="{StaticResource NavButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <FontIcon
                                        Glyph="&#xE8D6;"
                                        FontSize="16"
                                        Foreground="{StaticResource SpotifyGreenBrush}" />
                                    <TextBlock Text="Identificadas" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <!-- Footer: Settings + Spotify -->
                    <StackPanel Grid.Row="5" Margin="12,0,12,12" Spacing="4">
                        <!-- Settings -->
                        <Button 
                            x:Name="SettingsNavButton"
                            Click="SettingsNav_Click"
                            Style="{StaticResource NavButtonStyle}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <FontIcon 
                                    Glyph="&#xE713;" 
                                    FontSize="16"
                                    Foreground="{StaticResource TextSecondaryBrush}" />
                                <TextBlock Text="Ajustes" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                            </StackPanel>
                        </Button>

                        <!-- Spotify Connection -->
                        <Button 
                            x:Name="SpotifyButton"
                            Click="SpotifyButton_Click"
                            Style="{StaticResource NavButtonStyle}"
                            Padding="12,10">
                            <Grid HorizontalAlignment="Stretch">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Border 
                                    Width="24" 
                                    Height="24" 
                                    CornerRadius="5"
                                    Background="#1DB954"
                                    Margin="0,0,10,0">
                                    <FontIcon 
                                        Glyph="&#xE8D6;" 
                                        FontSize="12"
                                        Foreground="White" />
                                </Border>
                                <TextBlock 
                                    Grid.Column="1"
                                    x:Name="SpotifyStatusText" 
                                    Text="Spotify"
                                    FontSize="14"
                                    VerticalAlignment="Center"
                                    Foreground="{StaticResource TextSecondaryBrush}" />
                                <!-- Status indicator -->
                                <Ellipse
                                    Grid.Column="2"
                                    x:Name="SpotifyStatusDot"
                                    Width="8"
                                    Height="8"
                                    Fill="{StaticResource TextTertiaryBrush}"
                                    VerticalAlignment="Center" />
                            </Grid>
                        </Button>
                    </StackPanel>
                </Grid>
                </ScrollViewer>
            </Border>

            <!-- Main Content Frame -->
            <Frame 
                x:Name="ContentFrame" 
                Grid.Column="1" />
        </Grid>

        <!-- Bottom Player Bar - FULL WIDTH -->
        <controls:PlayerBar 
            x:Name="PlayerBarControl"
            Grid.Row="1" />

        <!-- Track Identified Modal (Spotify Style) -->
        <Grid 
            x:Name="TrackIdentifiedOverlay"
            Grid.ColumnSpan="2"
            Grid.RowSpan="2"
            Visibility="Collapsed"
            Background="#CC000000"
            Padding="0,48,0,0">
            
            <Border 
                x:Name="TrackIdentifiedCard"
                Background="{StaticResource CardBackgroundBrush}"
                CornerRadius="16"
                Width="380"
                MaxHeight="600"
                VerticalAlignment="Center"
                HorizontalAlignment="Center">
                
                <Grid>
                    <ScrollViewer 
                        VerticalScrollBarVisibility="Auto"
                        Padding="24">
                        <StackPanel Spacing="20">
                            <!-- Header -->
                            <TextBlock 
                                Text=" Canción identificada"
                                FontSize="13"
                                Foreground="{StaticResource TextSecondaryBrush}"
                                HorizontalAlignment="Center"
                                Margin="0,8,0,0" />
                        
                        <!-- Album Artwork -->
                        <Border 
                            Width="180" 
                            Height="180"
                            CornerRadius="12"
                            Background="{StaticResource BackgroundTertiaryBrush}"
                            HorizontalAlignment="Center">
                            <Grid>
                                <Image 
                                    x:Name="TrackArtworkSmall"
                                    Stretch="UniformToFill" />
                                <FontIcon 
                                    x:Name="TrackIconPlaceholder"
                                    Glyph="&#xE8D6;" 
                                    FontSize="64" 
                                    Foreground="{StaticResource TextTertiaryBrush}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                            </Grid>
                        </Border>
                        
                        <!-- Song Info -->
                        <StackPanel Spacing="4" HorizontalAlignment="Center">
                            <TextBlock 
                                x:Name="TrackTitle"
                                FontSize="20"
                                FontWeight="Bold"
                                Foreground="{StaticResource TextPrimaryBrush}"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                MaxWidth="320" />
                            <TextBlock 
                                x:Name="TrackArtist"
                                FontSize="16"
                                Foreground="{StaticResource SpotifyGreenBrush}"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                MaxWidth="320" />
                            <TextBlock 
                                x:Name="TrackAlbum"
                                FontSize="13"
                                Foreground="{StaticResource TextSecondaryBrush}"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                MaxWidth="320" />
                        </StackPanel>
                        
                        <!-- Action Buttons -->
                        <StackPanel Spacing="10" HorizontalAlignment="Center">
                            <!-- Spotify Button -->
                            <Button 
                                x:Name="AddToSpotifyButton"
                                Click="AddToSpotify_Click"
                                Background="{StaticResource SpotifyGreenBrush}"
                                Foreground="Black"
                                CornerRadius="20"
                                Padding="24,12"
                                BorderThickness="0"
                                HorizontalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <FontIcon Glyph="&#xE710;" FontSize="16" />
                                    <TextBlock Text="Buscar en Spotify" FontSize="14" FontWeight="SemiBold" />
                            </StackPanel>
                        </Button>
                        
                        <!-- Secondary actions -->
                        <StackPanel Orientation="Horizontal" Spacing="16" HorizontalAlignment="Center">
                            <Button 
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8"
                                CornerRadius="20"
                                ToolTipService.ToolTip="Me gusta">
                                <FontIcon Glyph="&#xE735;" FontSize="18" Foreground="{StaticResource TextSecondaryBrush}" />
                            </Button>
                            <Button 
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8"
                                CornerRadius="20"
                                ToolTipService.ToolTip="Compartir">
                                <FontIcon Glyph="&#xE72D;" FontSize="18" Foreground="{StaticResource TextSecondaryBrush}" />
                            </Button>
                            <Button 
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8"
                                CornerRadius="20"
                                ToolTipService.ToolTip="Más opciones">
                                <FontIcon Glyph="&#xE712;" FontSize="18" Foreground="{StaticResource TextSecondaryBrush}" />
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
                </ScrollViewer>
                
                <!-- Close button - on top of content -->
                <Button 
                    Click="CloseTrackCard_Click"
                    Background="#3C3C3C"
                    BorderThickness="0"
                    Padding="8"
                    CornerRadius="14"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,12,12,0"
                    Width="28"
                    Height="28">
                    <FontIcon Glyph="&#xE711;" FontSize="10" Foreground="{StaticResource TextPrimaryBrush}" />
                </Button>
                </Grid>
            </Border>
        </Grid>

        <!-- Identification Progress Overlay -->
        <Grid 
            x:Name="IdentifyProgressOverlay"
            Grid.ColumnSpan="2"
            Grid.RowSpan="2"
            Visibility="Collapsed"
            Background="#CC000000"
            Padding="0,48,0,0">
            <Border 
                Background="{StaticResource CardBackgroundBrush}"
                CornerRadius="16"
                Width="280"
                VerticalAlignment="Center"
                HorizontalAlignment="Center"
                Padding="24">
                <StackPanel Spacing="16" HorizontalAlignment="Center">
                    <ProgressRing 
                        x:Name="IdentifyProgressRing"
                        IsActive="True"
                        Width="48"
                        Height="48"
                        Foreground="{StaticResource SpotifyGreenBrush}" />
                    <TextBlock 
                        x:Name="IdentifyStatusText"
                        Text="Escuchando..."
                        FontSize="15"
                        FontWeight="SemiBold"
                        Foreground="{StaticResource TextPrimaryBrush}"
                        HorizontalAlignment="Center" />
                    <ProgressBar 
                        x:Name="IdentifyProgressBar"
                        Minimum="0"
                        Maximum="100"
                        Width="200"
                        Foreground="{StaticResource SpotifyGreenBrush}"
                        Background="{StaticResource BackgroundTertiaryBrush}"
                        CornerRadius="3" />
                    <Button 
                        Click="CancelIdentify_Click"
                        Content="Cancelar"
                        Background="Transparent"
                        Foreground="{StaticResource TextSecondaryBrush}"
                        BorderBrush="{StaticResource TextSubduedBrush}"
                        BorderThickness="1"
                        CornerRadius="16"
                        Padding="20,8"
                        HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Info Bar for notifications -->
        <InfoBar
            x:Name="NotificationBar"
            Grid.Column="1"
            Grid.Row="0"
            VerticalAlignment="Top"
            HorizontalAlignment="Center"
            Margin="0,16,0,0"
            IsOpen="False" />
    </Grid>
</Page>
